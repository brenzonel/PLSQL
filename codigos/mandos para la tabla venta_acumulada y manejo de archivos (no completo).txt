set serveroutput on
declare 
cursor f_vta is
select id_clte, valor, fecha_fact
from Factura_vta;
v_anio number;
v_mes varchar(5);
f_id_clt number;

begin
delete from ventas_acumulada;
 for venta in f_vta loop
	v_anio := to_number(to_char(venta.fecha_fact,'yyyy'));
	v_mes := to_number(to_char(venta.fecha_fact,'mm'));
  begin 
	select id_clte into f_id_clt
	from ventas_acumulada
	where id_clte = venta.id_clte and anio = v_anio and mes = v_mes;
	exception 
  when no_data_found then
  f_id_clt := null;
  end;
	--if f_vta%notfound then -----este found no se puede porque el sql es solo para insert, update y delete
  if f_id_clt is null then
      insert into ventas_acumulada values (venta.id_clte, v_anio, v_mes, venta.valor);
  else
      update ventas_acumulada set valor = nvl(valor,0) + venta.valor where id_clte = venta.id_clte and anio = v_anio and mes = v_mes;
  end if;
  end loop;
end;
/****************************************/

create or replace directory url_dir as 'C:\Users\asu\Desktop\Oracle';
grant read on directory url_dir to public;
grant write on directory url_dir to public;
grant execute on utl_file to public;
declare 
cadena varchar(256);
file utl_file.file_type;
begin 
cadena := 'si se pudo LEL';
file := utl_file.fopen ('url_dir','prueba.txt','a');
utl_file.put(file,cadena);
utl_file.fclose(file);
dbms_output.put_line('si se escribio');
end;